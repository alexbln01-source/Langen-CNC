<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Etikett Vorschau</title>

<style>

body {
  margin: 0;
  padding: 0;
  background: #dcdcdc;
  display: flex;
  flex-direction: column;
  height: 100vh;
  font-family: Arial, sans-serif;
}

/* ================================
   ✔ A5 Layout (148 × 210 mm)
=================================*/
.preview-wrapper {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
  overflow: hidden;
}

.preview-area {
  width: 210mm;
  height: 148mm;
  background: white;
  padding: 8mm;
  box-sizing: border-box;
  position: relative;

  /* AUTOMATISCHE SKALIERUNG FÜR HANDY */
  transform-origin: top center;
}

.textblock {
  text-align: center;
  width: 100%;
}

.logo-wrapper {
  position: absolute;
  right: 10mm;
  bottom: 10mm;
}

.logo-wrapper img {
  width: 42mm;
  height: auto;
}

/* ================================
   Buttons
=================================*/
.bottom-bar {
  display: flex;
  gap: 10px;
  padding: 10px;
  background: #ffffff;
  box-shadow: 0 -3px 6px rgba(0,0,0,0.25);
}

.btn {
  flex: 1;
  padding: 16px 10px;
  font-size: 20px;
  font-weight: bold;
  border-radius: 10px;
  color: white;
  border: none;
}

.btn:focus {
  outline: 5px solid #1a73e8;
}

.back-btn  { background: #9e9e9e; }
.print-btn { background: #2e7d32; }

/* ================================
   Druckmodus → Nur Etikett
=================================*/
@media print {
  .bottom-bar, .preview-wrapper {
    display: none !important;
  }

  #printArea {
    display: flex !important;
  }

  @page {
    size: A5 landscape;
    margin: 0;
  }

  body {
    background: white !important;
  }
}
</style>
</head>

<body>

<div class="preview-wrapper">
  <div id="scaledBox" class="preview-area">
    <div id="previewContent" class="textblock"></div>

    <div class="logo-wrapper">
      <img src="langen.png">
    </div>
  </div>
</div>

<!-- DRUCKVERSION -->
<div id="printArea" class="preview-area" style="display:none;">
  <div id="printContent" class="textblock"></div>

  <div class="logo-wrapper">
    <img src="langen.png">
  </div>
</div>

<div class="bottom-bar">
  <button class="btn back-btn" id="btnBack">◀ Zurück</button>
  <button class="btn print-btn" id="btnPrint">Drucken</button>
</div>

<script>
/* =====================================
   ETIKETT DATEN LADEN
=====================================*/
window.onload = () => {

  const params = new URLSearchParams(location.search);
  let data = {};

  if (params.get("data")) {
    data = JSON.parse(decodeURIComponent(params.get("data")));
  }

  const beistell = data.beistell || "";
  const type     = data.selectedType || "";
  const kunde    = data.kundename || "";

  let html = "";

  /* ===============================
     TEXT GENERIEREN
  =============================== */
  html += `<div style="font-size:60pt; font-weight:bold; margin-bottom:6mm;">${beistell}</div>`;

  const rows = {
    "LP":              ["L&P"],
    "LPEILT":          ["L&P", "„EILT SEHR“"],
    "SCHUETTE":        ["Schütte"],
    "SCHUETTEEILT":    ["Schütte","„EILT SEHR“"],
    "KLEY":            ["Kleymann"],
    "KLEYEILT":        ["Kleymann","„EILT SEHR“"],
    "COMTEZN8":        ["Comte","„Zn8“"],
    "COMTEZNI8":       ["Comte","„ZNi8“"],
    "CHEMISCH":        ["Comte","„Chemisch Vernickeln“"],
    "DICK":            ["Comte","„Dickschichtpassivierung“"],
    "BLAU":            ["Comte","„Blau ZN8“"],
    "PENTZ":           ["Pentz & Gerdes","„ZN8“"],
    "RCS":             ["RCS","„Schweißen“"],
    "COATINC":         ["Coatinc 24","„Verzinken“"]
  };

  if (rows[type]) {
    rows[type].forEach((line) => {
      html += `<div style="font-size:48pt; font-weight:bold; margin-bottom:4mm;">${line}</div>`;
    });
  }

  if (kunde) {
    html += `<div style="font-size:32pt; margin-top:6mm;">(${kunde})</div>`;
  }

  // Vorschau und Druck setzen
  document.getElementById("previewContent").innerHTML = html;
  document.getElementById("printContent").innerHTML   = html;

  /* =====================================
     AUTOMATISCHE SKALIERUNG FÜR HANDY
  ======================================*/
  function scalePreview() {
    const box = document.getElementById("scaledBox");
    const w = box.offsetWidth;
    const h = box.offsetHeight;

    const sw = window.innerWidth / w;
    const sh = (window.innerHeight * 0.80) / h; // 80% der Höhe benutzen

    const scale = Math.min(sw, sh);

    box.style.transform = `scale(${scale})`;
  }

  scalePreview();
  window.onresize = scalePreview;

  /* =====================================
     Buttons
  ======================================*/
  document.getElementById("btnPrint").onclick = () => window.print();

  document.getElementById("btnBack").onclick = () => {
    window.location.href = "index.html";
  };

  // Sofort Fokus auf Drucken
  setTimeout(() => document.getElementById("btnPrint").focus(), 300);
};

</script>

</body>
</html>