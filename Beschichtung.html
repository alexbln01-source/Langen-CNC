<script>
const zahl=document.getElementById('zahlA5');
const kunde=document.getElementById('kundeA5');
const out=document.getElementById('output-content');
const printInner=document.getElementById('printInner');
let currentType=null;

/* === Popup-Tastatur === */
const popup=document.getElementById('keyboardPopup');
const input=document.getElementById('keyboardInput');
const grid=document.getElementById('keyboardGrid');
let activeField=null; 
let mode='letters';

function buildKeyboard(type){
  grid.innerHTML='';
  const keys=(type==='numbers')
    ? ['1','2','3','4','5','6','7','8','9','0']
    : Array.from('QWERTZUIOPÜASDFGHJKLÖÄYXCVBNM');
  keys.forEach(k=>{
    const b=document.createElement('button');
    b.textContent=k;
    b.onclick=()=>input.value+=k;
    grid.appendChild(b);
  });
}

function openKeyboard(field,type){
  activeField=field;
  mode=type;
  input.value=field.value||'';
  buildKeyboard(type);
  popup.style.display='flex';
  setTimeout(()=>input.focus(),100);
}

function closeKeyboard(){
  popup.style.display='none';
  activeField=null;
}

document.getElementById('btnDel').onclick=()=>input.value=input.value.slice(0,-1);

/* === OK-Button-Logik mit automatischem Weiterspringen === */
document.getElementById('btnOk').onclick=()=>{
  if(activeField){
    activeField.value=input.value.trim();
    if(activeField===zahl){          // Nach Beistellnummer -> weiter zum Kunden
      openKeyboard(kunde,'letters');
      return;                        // springt direkt weiter, Vorschau erst nach Kunde
    }
    closeKeyboard();                 // Nach Kunde -> schließen
    updatePreview();
  }
};

document.getElementById('btnClose').onclick=closeKeyboard;

input.addEventListener('keydown',e=>{
  if(e.key==='Enter'){e.preventDefault();document.getElementById('btnOk').click();}
  if(e.key==='Escape'){e.preventDefault();closeKeyboard();}
});

zahl.onclick=()=>openKeyboard(zahl,'numbers');
kunde.onclick=()=>openKeyboard(kunde,'letters');

/* === Vorschau-Aufbau === */
function line(t,s){return `<div style="font-size:${s}pt;">${t}</div>`;}
function layout(t,z,k){
  let html=line(z,36);
  const kundeLine=k?line(`(${k})`,32):'';
  switch(t){
    case 'COMTEZN8': html+=line('Comte',48)+line('„ZN8“',32)+kundeLine; break;
    case 'CHEMISCH': html+=line('Comte',48)+line('„chemisch Vernickeln“',32)+kundeLine; break;
    case 'DICK': html+=line('Comte',48)+line('„Dickschichtpassivierung“',32)+kundeLine; break;
    case 'BLAU': html+=line('Comte',48)+line('„Blau ZN8“',32)+kundeLine; break;
    case 'PENTZ': html+=line('Pentz & Gerdes',48)+line('„ZN8“',32)+kundeLine; break;
    case 'RCS': html+=line('RCS GmbH',48)+line('„Schweißen“',32)+kundeLine; break;
    case 'COATINC': html+=line('Coatinc 24 GmbH',48)+line('„Verzinken“',32)+kundeLine; break;
    default: html+=line(t,48)+kundeLine; break;
  }
  return html;
}

function updatePreview(){
  if(window.innerWidth<=900) return;
  const z=zahl.value.trim();
  if(!z){out.innerHTML='';return;}
  const k=kunde.value.trim();
  out.innerHTML=layout(currentType,z,k);
}

/* === Kundenbuttons === */
document.querySelectorAll('#lieferanten .action').forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll('#lieferanten .action').forEach(x=>x.classList.remove('selected'));
    b.classList.add('selected');
    currentType=b.dataset.type;
    updatePreview();
  };
});

/* === Drucken === */
document.getElementById('btnDrucken').onclick=()=>{
  const z=zahl.value.trim(); if(!z){alert('Bitte Beistellnummer eingeben!');return;}
  const k=kunde.value.trim();
  if(!currentType){alert('Bitte Kunden wählen!');return;}

  printInner.innerHTML=layout(currentType,z,k);
  const area=document.getElementById('printArea');
  area.style.display='block';
  setTimeout(()=>{
    window.print();
    area.style.display='none';
  },150);
};

/* === Zurück === */
document.getElementById('btnBack').onclick=()=>window.location.href='index.html';
</script>
