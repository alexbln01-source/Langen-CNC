<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta
  name="viewport"
  content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
/>
<meta name="format-detection" content="telephone=no" />
<title>Beschichtung ‚Äì Handy (A5 quer)</title>

<style>
  :root{
    --btnH:56px;
    --pad:12px;
    --blue:#0d6efd;
    --blue2:#0b5ed7;
    --grey:#e9ecef;
    --dark:#263238;
  }
  html,body{
    margin:0; padding:0; height:100%;
    font-family: Arial, Helvetica, sans-serif;
    background:#f4f6f8;
    touch-action: manipulation;           /* kein Doppeltap-Zoom */
    -ms-touch-action: manipulation;
  }

  /* Layout */
  #wrap{
    display:flex; flex-direction:column; gap:10px;
    max-width: 700px; margin:0 auto; padding: 14px 10px 18px;
  }
  h1{
    margin:0 0 6px; text-align:center; color:#004b8d; font-size:22px;
  }

  .card{
    background:#fff; border:1px solid #d9dee3; border-radius:12px;
    padding: 12px;
    box-shadow: 0 2px 10px rgba(0,0,0,.06);
  }

  label{ display:block; font-weight:700; color:#333; margin:6px 6px 4px; }
  .textbox{
    width: 100%; height: var(--btnH); border:1px solid #cfd3d7; border-radius:10px;
    font-size:18px; text-align:center; background:#fff;
  }
  .textbox[readonly]{
    caret-color: transparent;
    user-select:none; -webkit-user-select:none;
  }

  /* Kunden-Buttons: 3 pro Zeile, gro√üe Touch-Ziele */
  #kunden{
    display:grid; gap:8px; grid-template-columns: repeat(3, 1fr);
    margin-top: 6px;
  }
  .kbtn{
    height: var(--btnH); border-radius:12px; border:1px solid #cfd3d7;
    background: linear-gradient(#f8f9fb,#eef1f4);
    font-weight:700; font-size:14px;
  }
  .kbtn:active{ transform: translateY(1px); }
  .kbtn.active{ background: var(--blue); color:#fff; border-color: var(--blue2); }

  /* Row: Zur√ºck / Drucken */
  .row{
    display:flex; gap:10px; margin-top: 8px;
  }
  .btn{
    flex:1; height: var(--btnH); border-radius:12px; border:1px solid #cfd3d7;
    background: linear-gradient(#f8f9fb,#eef1f4);
    font-weight:800; font-size:16px;
  }
  .btn.primary{ background: linear-gradient(#0d6efd,#0b5ed7); color:#fff; border-color:#0b5ed7; }

  /* Inline-Output (nur zur Live-Kontrolle, kein scrollen n√∂tig) */
  #live{
    text-align:center; font-weight:900;
    padding:8px; min-height: 40px;
  }

  /* ===== Vorschau-Overlay ===== */
  #preview{
    position:fixed; inset:0; background: rgba(0,0,0,.65);
    display:none; align-items:center; justify-content:center; z-index: 4000;
  }
  .pbox{
    background:#fff; border-radius:14px; border: 1px solid #cfd3d7;
    width: 92vw; max-width: 820px;
    padding: 10px 10px 14px;
    display:flex; flex-direction:column; gap:10px;
  }
  .plate-frame{
    width: 100%; aspect-ratio: 210 / 148;               /* A5 quer */
    border:1px solid #cfd3d7; border-radius:10px;
    display:flex; align-items:center; justify-content:center;
    overflow:hidden; background:#fff;
  }
  /* Das echte A5-Label ‚Äì nur skaliert ins Fenster eingebettet */
  .output-box{
    width:210mm; height:148mm; box-sizing:border-box;
    border:none; padding: 8mm; position:relative;
    display:flex; flex-direction:column; align-items:center; justify-content:center;
  }
  #output-content{ text-align:center; font-weight:900; line-height:1.2; }
  #output-footer{ position:absolute; right:8mm; bottom:6mm; }
  #output-footer img{ width:4.34cm; height:1.66cm; object-fit:contain; }

  .prow{ display:flex; gap:10px; }
  .prow .btn{ height:52px; font-size:16px; }

  /* Druck: nur das echte Label */
  @media print{
    @page{ size: A5 landscape; margin: 0; }
    html,body{ width:210mm; height:148mm; margin:0; padding:0; overflow:hidden; background:#fff; }
    body *{ visibility:hidden !important; }
    #printArea, #printArea *{ visibility: visible !important; }
    #printArea{
      position:absolute; inset:0; width:210mm; height:148mm;
      border:none !important; box-shadow:none !important;
    }
  }
</style>

<script>
  /* Kein Pinch/Doppeltap-Zoom */
  window.addEventListener('gesturestart', e=> e.preventDefault(), {passive:false});
  let lastTouch=0;
  document.addEventListener('touchend', e=>{
    const now=Date.now();
    if(now-lastTouch<350){ e.preventDefault(); }
    lastTouch = now;
  }, {passive:false});
</script>
</head>
<body>

<div id="wrap">
  <h1>Beschichtung</h1>

  <!-- Eingaben -->
  <div class="card">
    <label>Beistellnummer</label>
    <input id="inNum" class="textbox" type="text" readonly />
  </div>
  <div class="card" id="kundeCard">
    <label>Kunde</label>
    <input id="inKunde" class="textbox" type="text" readonly />
  </div>

  <!-- Kundenwahl -->
  <div class="card">
    <label style="margin-bottom:6px;">Kunde / Prozess w√§hlen</label>
    <div id="kunden">
      <button class="kbtn" data-type="LP">L&amp;P</button>
      <button class="kbtn" data-type="LPEILT">L&amp;P EILT SEHR</button>
      <button class="kbtn" data-type="SCHUETTE">Sch√ºtte</button>
      <button class="kbtn" data-type="SCHUETTEEILT">Sch√ºtte EILT SEHR</button>
      <button class="kbtn" data-type="KLEY">Kleymann</button>
      <button class="kbtn" data-type="KLEYEILT">Kleymann EILT SEHR</button>
      <button class="kbtn" data-type="COMTEZN8">Comte ZN8</button>
      <button class="kbtn" data-type="CHEMISCH">Comte Chemisch Vernickeln</button>
      <button class="kbtn" data-type="DICK">Comte Dickschichtpassivierung</button>
      <button class="kbtn" data-type="BLAU">Comte Blau ZN8</button>
      <button class="kbtn" data-type="PENTZ">Pentz &amp; Gerdes ZN8</button>
      <button class="kbtn" data-type="RCS">RCS Schwei√üen</button>
      <button class="kbtn" data-type="COATINC">Coatinc 24 Verzinken</button>
    </div>
  </div>

  <!-- Row -->
  <div class="row">
    <button id="btnBack" class="btn">‚¨ÖÔ∏è Abbrechen</button>
    <button id="btnPreview" class="btn primary">üñ® Drucken</button>
  </div>

  <!-- (Kleine) Live-Vorschau-Zeile -->
  <div id="live" class="card"></div>
</div>

<!-- ====== Vorschau-Overlay ====== -->
<div id="preview">
  <div class="pbox">
    <div class="plate-frame">
      <!-- das echte Druck-Label (A5 quer), live bef√ºllt -->
      <div class="output-box" id="printArea">
        <div id="output-content"></div>
        <div id="output-footer"><img src="Langen.png" alt="Logo" /></div>
      </div>
    </div>
    <div class="prow">
      <button id="btnCancel" class="btn">Abbrechen</button>
      <button id="btnNow" class="btn primary">Jetzt drucken</button>
    </div>
  </div>
</div>

<!-- ====== POPUP-TASTATUR ====== -->
<div id="kbd" style="position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.55);z-index:4500;">
  <div style="background:#fff; width:min(720px,94vw); padding:14px; border-radius:16px; border:1px solid #cfd3d7; box-shadow:0 12px 30px rgba(0,0,0,.25); display:flex; flex-direction:column; gap:10px;">
    <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
      <h3 id="kbdTitle" style="margin:0; color:#004b8d;">Eingabe</h3>
      <button id="kbdClose" class="btn" style="flex:0 0 auto; height:40px;">Schlie√üen</button>
    </div>
    <input id="kbdInput" type="text"
           style="height:56px; border:1px solid #cfd3d7; border-radius:12px; text-align:center; font-size:20px; outline:none;" />

    <!-- Zahlenfeld -->
    <div id="gridNum" style="display:none; grid-template-columns:repeat(3,1fr); gap:10px;">
      <!-- Zahlen-Buttons werden per JS gef√ºllt -->
    </div>

    <!-- QWERTZ Feld (3 Reihen) -->
    <div id="gridAlpha" style="display:none; display:grid; gap:8px;">
      <div class="rowA" style="display:grid; grid-template-columns: repeat(10, 1fr); gap:8px;"></div>
      <div class="rowB" style="display:grid; grid-template-columns: repeat(9, 1fr); gap:8px; margin:0 25px;"></div>
      <div class="rowC" style="display:grid; grid-template-columns: repeat(8, 1fr); gap:8px; margin:0 50px;"></div>
    </div>

    <!-- Aktionen -->
    <div style="display:flex; gap:10px;">
      <button id="kbdDel" class="btn" style="height:52px;">‚å´ L√∂schen</button>
      <button id="kbdOK" class="btn primary" style="height:52px;">OK</button>
    </div>
  </div>
</div>

<script>
/* ---------- Modell ---------- */
const inNum   = document.getElementById('inNum');
const inKunde = document.getElementById('inKunde');
const live    = document.getElementById('live');

const preview   = document.getElementById('preview');
const printArea = document.getElementById('printArea');
const out       = document.getElementById('output-content');

let selType = null;

/* ---------- Popup-Keyboards ---------- */
const kbd = document.getElementById('kbd');
const kbdInput = document.getElementById('kbdInput');
const kbdTitle = document.getElementById('kbdTitle');
const gridNum  = document.getElementById('gridNum');
const gridAlpha= document.getElementById('gridAlpha');
const kbDel    = document.getElementById('kbdDel');
const kbOK     = document.getElementById('kbdOK');

let targetField = null;
let mode = 'num';

function makeKey(txt){
  const b=document.createElement('button');
  b.className='btn'; b.style.height='56px'; b.style.borderRadius='14px';
  b.textContent = txt;
  b.onclick = ()=>{ kbdInput.value += txt; kbdInput.focus(); };
  return b;
}

function openKbd(field, kind){
  targetField = field;
  mode = kind;
  kbdTitle.textContent = (kind==='num') ? 'Beistellnummer eingeben' : 'Kundenname eingeben';
  kbdInput.value = field.value || '';

  gridNum.style.display   = (kind==='num') ? 'grid' : 'none';
  gridAlpha.style.display = (kind==='alpha') ? 'grid' : 'none';

  kbd.style.display='flex';
  setTimeout(()=>kbdInput.focus(), 80);
}

function closeKbd(){ kbd.style.display='none'; }

document.getElementById('kbdClose').onclick = closeKbd;
kbDel.onclick = ()=>{ kbdInput.value = kbdInput.value.slice(0,-1); };
kbOK.onclick = ()=>{
  targetField.value = kbdInput.value.trim();
  if(targetField===inNum){
    openKbd(inKunde,'alpha');
  }else{
    closeKbd();
  }
};

/* ENTER: weiter / schlie√üen */
kbdInput.addEventListener('keydown', e=>{
  if(e.key==='Enter'){
    e.preventDefault();
    kbOK.click();
  }
});

/* Zahlen-Layout bauen (3x4 + 0, ‚Üê) */
(function buildNum(){
  const nums = ['1','2','3','4','5','6','7','8','9','0'];
  gridNum.innerHTML='';
  // 1..9
  for(let i=1;i<=9;i++) gridNum.appendChild(makeKey(String(i)));
  // 0 in Mitte der letzten Zeile
  const spacer1 = document.createElement('div'); spacer1.style.visibility='hidden';
  const zero = makeKey('0');
  const back = document.createElement('button'); back.className='btn'; back.style.height='56px'; back.style.borderRadius='14px'; back.textContent='‚Üê'; back.onclick=()=>kbDel.click();
  gridNum.appendChild(spacer1);
  gridNum.appendChild(zero);
  gridNum.appendChild(back);
})();

/* QWERTZ-Layout (3 Reihen, ohne Scroll) */
(function buildAlpha(){
  const rowA = gridAlpha.querySelector('.rowA');
  const rowB = gridAlpha.querySelector('.rowB');
  const rowC = gridAlpha.querySelector('.rowC');
  const A = ['Q','W','E','R','T','Z','U','I','O','P'];
  const B = ['A','S','D','F','G','H','J','K','L','√ñ'];
  const C = ['Y','X','C','V','B','N','M','√ú']; // Umlaut + YZ richtig
  rowA.innerHTML = ''; A.forEach(k=> rowA.appendChild(makeKey(k)));
  rowB.innerHTML = ''; B.forEach(k=> rowB.appendChild(makeKey(k)));
  rowC.innerHTML = ''; C.forEach(k=> rowC.appendChild(makeKey(k)));
})();

/* Eingabefelder click ‚Üí Popup-Kbd */
inNum.addEventListener('click',  ()=>openKbd(inNum,'num'));
inKunde.addEventListener('click',()=>openKbd(inKunde,'alpha'));

/* ---------- Kunden-Buttons ---------- */
function render(type){
  selType = type;
  document.querySelectorAll('.kbtn').forEach(b=>b.classList.toggle('active', b.dataset.type===type));

  const n = inNum.value.trim();
  const k = inKunde.value.trim();
  if(!n){ live.textContent = 'Beistellnummer fehlt ‚Ä¶'; return; }

  let html = `<div style="font-size:36pt;margin-bottom:6mm;">${n}</div>`;

  const add = (main, sub='', name='')=>{
    html += `<div style="font-size:48pt; font-weight:900;">${main}</div>`;
    if(sub)  html += `<div style="font-size:32pt;">‚Äû${sub}‚Äú</div>`;
    if(name) html += `<div style="font-size:32pt;">(${name})</div>`;
  };

  switch(type){
    case 'LP':        add('L&P'); break;
    case 'LPEILT':    add('L&P','EILT SEHR'); break;
    case 'SCHUETTE':  add('Sch√ºtte'); break;
    case 'SCHUETTEEILT': add('Sch√ºtte','EILT SEHR'); break;
    case 'KLEY':      add('Kleymann'); break;
    case 'KLEYEILT':  add('Kleymann','EILT SEHR'); break;

    case 'COMTEZN8':  add('Comte','ZN8', inKunde.value.trim()); break;
    case 'CHEMISCH':  add('Comte','Chemisch Vernickeln', inKunde.value.trim()); break;
    case 'DICK':      add('Comte','Dickschichtpassivierung', inKunde.value.trim()); break;
    case 'BLAU':      add('Comte','Blau ZN8', inKunde.value.trim()); break;

    case 'PENTZ':     add('Pentz & Gerdes','ZN8', inKunde.value.trim()); break;
    case 'RCS':       add('RCS GmbH','Schwei√üen', inKunde.value.trim()); break;
    case 'COATINC':   add('Coatinc 24 GmbH','Verzinken', inKunde.value.trim()); break;
  }

  // Live-Minivorschau in der Karte
  live.innerHTML = html;

  // Auch in die echte Druckfl√§che schreiben (identisch!)
  out.innerHTML = html;

  centerWithLogo();       // Logo ber√ºcksichtigen, zentrieren
}

/* Buttons verdrahten */
document.querySelectorAll('#kunden .kbtn')
  .forEach(b=> b.addEventListener('click', ()=>render(b.dataset.type)));

/* Zentrierung mit Logo-Abzug */
function centerWithLogo(){
  // Outermitte zwischen Box-Top und Logo-Top ermitteln
  const top = printArea.getBoundingClientRect().top;
  const logoTop = document.getElementById('output-footer').getBoundingClientRect().top;
  const usable = logoTop - top; // nutzbare H√∂he oberhalb des Logos
  const contentH = out.getBoundingClientRect().height;

  // vertikal mittig in usable-Bereich
  const mt = Math.max((usable - contentH)/2, 0);
  out.style.marginTop = mt + 'px';
}

/* Vorschau √∂ffnen */
document.getElementById('btnPreview').addEventListener('click', ()=>{
  if(!selType){ alert('Bitte zuerst Kunde/Prozess w√§hlen.'); return; }
  if(!inNum.value.trim()){ alert('Bitte Beistellnummer eingeben.'); return; }
  // Inhalt ist bereits im printArea/out; nur Overlay zeigen
  preview.style.display='flex';
  // Nach Layout-Update neu zentrieren
  setTimeout(centerWithLogo, 60);
});

/* Vorschau schlie√üen / Drucken */
document.getElementById('btnCancel').onclick = ()=> preview.style.display='none';

document.getElementById('btnNow').onclick = ()=>{
  // Echt drucken ‚Äì das @media print rendert nur #printArea
  window.print();
  preview.style.display='none';
};

/* Abbrechen zur√ºck zur Startseite */
document.getElementById('btnBack').onclick = ()=> window.location.href='index.html';

/* Beim Resize: Zentrierung stabil halten */
window.addEventListener('resize', ()=> setTimeout(centerWithLogo, 60));
</script>
</body>
</html>