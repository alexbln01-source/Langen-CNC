<script>
const num = document.getElementById('numInput');
const kunde = document.getElementById('kundeInput');
const popup = document.getElementById('keyboardPopup');
const kbInput = document.getElementById('keyboardInput');
const kbGrid = document.getElementById('keyboardGrid');
let currentField = null;
let selectedType = null;

/* ===========================
   ðŸ“± Popup Tastatur
=========================== */
function buildKeyboard(type) {
  kbGrid.innerHTML = '';
  const chars = (type === 'numbers')
    ? ['1','2','3','4','5','6','7','8','9','0']
    : 'QWERTZUIOPASDFGHJKLYXCVBNM'.split('');
  chars.forEach(c => {
    const b = document.createElement('button');
    b.textContent = c;
    b.onclick = () => kbInput.value += c;
    kbGrid.appendChild(b);
  });
}
function openKeyboard(field, type) {
  currentField = field;
  kbInput.value = field.value || '';
  buildKeyboard(type);
  popup.style.display = 'flex';
}
function closeKeyboard() { popup.style.display = 'none'; }

document.getElementById('btnDel').onclick = () => kbInput.value = kbInput.value.slice(0, -1);
document.getElementById('btnClose').onclick = closeKeyboard;
document.getElementById('btnOk').onclick = () => {
  currentField.value = kbInput.value.trim();
  closeKeyboard();
};
num.onclick = () => openKeyboard(num, 'numbers');
kunde.onclick = () => openKeyboard(kunde, 'letters');

/* ===========================
   ðŸ§¾ Vorschau anzeigen
=========================== */
function makeOutput(type) {
  selectedType = type; // Kunde merken
  const n = num.value.trim();
  const k = kunde.value.trim();

  let html = `<div style="font-size:36pt;margin-bottom:6mm;">${n || ''}</div>`;
  const add = (main, sub = '', name = '') => {
    html += `<div style="font-size:48pt;font-weight:900;">${main}</div>`;
    if (sub) html += `<div style="font-size:32pt;">â€ž${sub}â€œ</div>`;
    if (name) html += `<div style="font-size:32pt;">(${name})</div>`;
  };

  switch (type) {
    case 'LP': add('L&P'); break;
    case 'LPEILT': add('L&P', 'EILT SEHR'); break;
    case 'SCHUETTE': add('SchÃ¼tte'); break;
    case 'SCHUETTEEILT': add('SchÃ¼tte', 'EILT SEHR'); break;
    case 'KLEY': add('Kleymann'); break;
    case 'KLEYEILT': add('Kleymann', 'EILT SEHR'); break;
    case 'COMTEZN8': add('Comte', 'ZN8', k); break;
    case 'CHEMISCH': add('Comte', 'Chemisch Vernickeln', k); break;
    case 'DICK': add('Comte', 'Dickschichtpassivierung', k); break;
    case 'BLAU': add('Comte', 'Blau ZN8', k); break;
    case 'PENTZ': add('Pentz & Gerdes', 'ZN8', k); break;
    case 'RCS': add('RCS GmbH', 'SchweiÃŸen', k); break;
    case 'COATINC': add('Coatinc 24 GmbH', 'Verzinken', k); break;
  }

  document.getElementById('output-content').innerHTML = html;
}

document.querySelectorAll('#kunden button').forEach(btn => {
  btn.onclick = () => {
    document.querySelectorAll('#kunden button').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    makeOutput(btn.dataset.type);
  };
});

/* ===========================
   ðŸ–¨ Drucken
=========================== */
document.getElementById('btnDrucken').onclick = () => {
  const n = num.value.trim();
  const k = kunde.value.trim();

  // erst prÃ¼fen beim Druck
  if (!n || !k || !selectedType) {
    alert('Bitte Beistellnummer, Kunde und Kundentyp auswÃ¤hlen.');
    return;
  }

  document.getElementById('previewPopup').style.display = 'flex';
};

/* ===========================
   ðŸ–¨ Vorschau Buttons
=========================== */
document.getElementById('btnPrintNow').onclick = () => {
  const n = num.value.trim();
  const k = kunde.value.trim();

  if (!n || !k || !selectedType) {
    alert('Bitte zuerst Beistellnummer, Kunde und Kundentyp eingeben.');
    return;
  }

  window.print();
  setTimeout(() => document.getElementById('previewPopup').style.display = 'none', 600);
};

document.getElementById('btnCancelPreview').onclick = () =>
  document.getElementById('previewPopup').style.display = 'none';

document.getElementById('btnBack').onclick = () => window.location.href = 'index.html';
</script>